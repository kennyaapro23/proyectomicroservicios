<div class="p-6 max-w-5xl mx-auto">

    <h2 class="text-3xl font-bold mb-6 flex items-center gap-2">
        {{ authService.isAdmin() ? 'ğŸ§¾ Ventas Registradas' : 'ğŸ›’ Mis Compras' }}
    </h2>

    <!-- Estado de carga -->
    <div *ngIf="isLoading" class="text-blue-600 mb-4 flex items-center gap-2">
        <span class="animate-spin">ğŸ”„</span> Cargando informaciÃ³n...
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="text-red-600 mb-4 border border-red-200 bg-red-50 p-3 rounded">
        âš ï¸ {{ errorMessage }}
    </div>

    <!-- Listado de ventas/compras -->
    <!-- Filtros -->
    <div class="mb-4">
        <div class="mb-2">
            <label class="block text-sm text-gray-600 mb-1">Rango rÃ¡pido</label>
            <div class="flex gap-2">
                <button (click)="applyPreset('week')" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200">Ãšltima semana</button>
                <button (click)="applyPreset('15')" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200">Ãšltimos 15 dÃ­as</button>
                <button (click)="applyPreset('30')" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200">Ãšltimos 30 dÃ­as</button>
                <button (click)="applyPreset('all')" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200">Todo</button>
            </div>
        </div>

        <div class="flex gap-3 items-end">
            <div>
                <label class="block text-sm text-gray-600">Desde (fecha y hora)</label>
                <input type="datetime-local" [(ngModel)]="dateFrom" class="border rounded px-2 py-1" />
            </div>
            <div>
                <label class="block text-sm text-gray-600">Hasta (fecha y hora)</label>
                <input type="datetime-local" [(ngModel)]="dateTo" class="border rounded px-2 py-1" />
            </div>
            <div>
                <button (click)="filterVentas()" class="bg-blue-600 text-white px-3 py-1 rounded">Aplicar filtro</button>
                <button (click)="resetFilters()" class="ml-2 bg-gray-200 px-3 py-1 rounded">Limpiar</button>
            </div>
        </div>
    </div>
    <div *ngIf="ventas.length > 0; else sinDatos" class="space-y-6">

        <div *ngFor="let venta of ventas" class="border border-gray-300 rounded-lg shadow bg-white p-6 hover:shadow-lg transition">

            <!-- Encabezado de venta -->
            <div class="flex justify-between items-center mb-4">
                <div>
                    <p class="text-sm text-gray-500">ID Venta</p>
                    <p class="text-xl font-bold text-purple-700">#{{ venta.id }}</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500">Fecha:</p>
                    <p class="text-base text-gray-700">{{ venta.saleDate | date:'medium' }}</p>
                </div>
            </div>

            <!-- Detalles principales -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <p class="font-medium">ğŸ’µ Total:</p>
                    <p class="text-green-700 font-semibold">{{ venta.totalAmount | currency:'USD' }}</p>
                </div>
                <div>
                    <p class="font-medium">ğŸ’³ MÃ©todo de Pago:</p>
                    <p class="text-gray-800">{{ venta.paymentMethod }}</p>
                </div>
                <div>
                    <p class="font-medium">ğŸ“¦ Estado:</p>
                    <span [ngClass]="{
            'bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded': venta.status === 'pendiente',
            'bg-green-100 text-green-800 px-2 py-0.5 rounded': venta.status === 'paid'
          }">
            {{ venta.status }}
          </span>
                </div>
            </div>

            <!-- Datos de Cliente (Solo Admin) -->
            <div *ngIf="authService.isAdmin() && venta.orderDto?.clientDto" class="border-t pt-4 mt-4">
                <p class="font-medium text-gray-700">ğŸ‘¤ Cliente:</p>
                <p class="text-gray-800">
                    {{ venta.orderDto?.clientDto?.name || 'Sin nombre' }}
                    <span class="text-sm text-gray-500">({{ venta.orderDto?.clientDto?.email || 'Sin correo' }})</span>
                </p>

            </div>

            <!-- Productos comprados -->
            <div *ngIf="venta.orderDto?.orderDetails?.length" class="mt-4">
                <p class="font-medium text-gray-700 mb-2">ğŸ›’ Productos:</p>
                <ul class="divide-y divide-gray-200">
                    <li *ngFor="let item of venta.orderDto?.orderDetails" class="py-2 flex justify-between">
                        <div>
                            <p class="font-medium">{{ item.productDto?.name || 'Producto' }}</p>
                            <p class="text-sm text-gray-500">Cantidad: {{ item.amount }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-green-700 font-semibold">{{ item.totalPrice | currency:'USD' }}</p>
                        </div>
                    </li>
                </ul>
            </div>

        </div>

    </div>

    <!-- Si no hay datos -->
    <ng-template #sinDatos>
        <div class="text-center text-gray-500 mt-10">
            ğŸš« No se encontraron registros.
        </div>
    </ng-template>

</div>
